plugin.onLoad(async () => {
	new MutationObserver(() => {
		if (!document.querySelector('.m-pinfo .bar .btns')) return;
		if (document.querySelector('.m-pinfo .bar .btns .btn-beatsaver')) return;
		const prev = document.querySelector('.m-pinfo .bar .btns .btn-share');
		const btn = document.createElement('div');
		btn.className = 'z-off btn btn-beatsaver';
		btn.title = '在 beatsaver 中搜索';
		btn.innerHTML = `
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 145.92 146.01">
				<path d="M72.48,3c.53,0,1.19.35,1.94,1.05l.03.03.03.03c3.97,3.47,7.58,7.14,11.41,11.03,2.07,2.1,4.21,4.28,6.39,6.4,6.53,6.53,13.76,13.76,20.88,20.89,6.38,6.39,12.69,12.7,18.35,18.36.97,1.05,2.24,2.28,3.58,3.58,2.48,2.4,7.65,7.39,7.82,9.13v.02c-.16,1.74-5.17,6.59-7.58,8.92-1.36,1.32-2.65,2.56-3.62,3.63-6.27,6.27-13.34,13.34-20.42,20.43-6.33,6.33-12.67,12.68-18.46,18.47-1.48,1.47-2.93,2.93-4.36,4.36-3.25,3.26-6.32,6.34-9.44,9.41l-.44.42c-1.97,1.9-4,3.87-5.35,3.87-.54,0-1.2-.35-1.96-1.05l-.03-.02-.03-.02c-4.02-3.52-7.66-7.22-11.52-11.14-2.09-2.12-4.25-4.32-6.47-6.48-6.89-6.88-14.72-14.72-22.38-22.38-6.65-6.65-13.17-13.18-18.84-18.85l-1.3-1.3c-4.48-4.47-7.73-7.7-7.73-9.28,0-1.53,3.09-4.62,7.36-8.88l1.63-1.63c6.32-6.31,13.69-13.69,21.09-21.1,6.75-6.76,13.54-13.56,19.61-19.62,1.47-1.47,2.91-2.91,4.33-4.34,3.42-3.43,6.65-6.67,9.98-9.93,1.91-1.86,4.08-3.97,5.47-3.97M72.48,0c-2.57,0-4.92,2.25-7.56,4.82-4.75,4.66-9.36,9.33-14.34,14.3-12.73,12.71-28.62,28.65-40.71,40.72-13.1,13.13-13.24,12.07.03,25.33,12.21,12.2,28.35,28.38,41.22,41.24,6.29,6.12,11.77,12.19,18.13,17.75,1.43,1.31,2.74,1.84,3.99,1.84,2.7,0,5.14-2.5,7.87-5.13,4.56-4.49,9.07-9.04,13.84-13.81,12.29-12.28,27.04-27.07,38.93-38.95,3.5-3.87,12.03-10.75,12.04-14.59v-.07c-.06-3.84-8.66-10.86-12.23-14.76-12-12-26.88-26.9-39.28-39.3-6.19-6.03-11.68-12.09-17.95-17.57C75.04.54,73.74,0,72.48,0h0Z"/>
				<path d="M85.52,85.55c-1.68,1.68-2.37,4.54-3.19,8.86-.9,4.88-1.83,10.22-2.79,15.55-.83,4.7-1.6,8.79-1.86,11.21-.17,1.63-.11,2.56.32,2.75.35.17.96-.16,1.85-.9,1.15-.97,2.49-2.31,3.73-3.54,9.42-9.43,29.81-29.77,37.65-37.68,1.12-1.26,2.75-2.58,2.76-3.78-.15-.54-1.29-.57-3.39-.31-2.29.29-5.75.93-9.71,1.63-4.54.81-9.66,1.72-13.89,2.48-4.18.74-9.74,1.69-11.4,3.66l-.07.07Z"/>
			</svg>
		`;
		btn.addEventListener('click', () => {
			const songInfo = betterncm.ncm.getPlayingSong();
			const songName = songInfo.data.name;
			const artist = songInfo.data.artists.map(artist => artist.name).join(' ');
			const url = `https://beatsaver.com/?q=${encodeURIComponent(`${songName} ${artist}`)}`;
			betterncm.app.exec(url);
		});

		prev.parentNode.insertBefore(btn, prev.nextSibling);
	}).observe(await betterncm.utils.waitForElement('.m-pinfo'), { childList: true, subtree: true });
});